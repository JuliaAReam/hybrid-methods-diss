\chapter{Simulations}


\section{Computational Domain}
\subsection{AMR and Discretization}
Our target simulation is a 3D LES with a grid size that is 100 times the smallest scale of the turbulent flow. In our setup, the domain length in each direction is: $x = 25d$, $y = 62.5d$, and $z = 25d$, where the jet diameter $d=\SI{.01}{cm}$ and the $y$-axis is the axial direction of the jet. This smallest scale of these turbulent flows, known as the Kolmogorov scale \cite{kolmogorov}, can be approximated:
\begin{equation} \label{Kolmogorov}
	\eta = \left( \dfrac{\nu^3}{\varepsilon} \right)
\end{equation}
where $\nu = \nicefrac{\mu}{\rho}$ is the kinematic viscosity and $\varepsilon = \nicefrac{v_j^3}{d}$ is used to approximate the average rate of dissipation of turbulence kinetic energy per unit mass. For these turbulent jets, $\eta = \SI{5.37e-6}{cm}$. Therefore, to keep the calculation tractable and achieve an adequate \gls{les} grid size, we implement four levels of refinement, with a refinement ratio of 2, leading to 80, 200, and 80 cells on the coarsest level in the $x$, $y$, and $z$ directions, respectively. This results in an initial mesh size of $\Delta x_{0}=\Delta y_{0}=\Delta z_{0}=0.3125$, leading to $\Delta x_{3}=\Delta y_{3}=\Delta z_{3}=\SI{3.9062e-4}{}$, where the subscript denotes the \gls{amr} level. These four levels of refinement occur in the region outward from the jet inlet up to a distance of $20d$ in the $x$ and $z$ direction and $60d$ in the $y$ direction, as can be seen in Figure \ref{fig:domain}. The refinement criterion is given by the vorticity, specifically with $\omega \geq 5000^{2l}$, where $\omega$ is the magnitude of the vorticity and $l$ is the \gls{amr} level. For the first ten flow throughs of the simulation, mesh refinement only occurs up to one level within the refinement region to establish the flow pattern. Thereafter, the simulation proceeds  with the four levels of mesh refinement until reaching steady state, whereupon statistics are collected for analysis.
\begin{figure}[h!]
\centering
\begin{tikzpicture} [scale = .6]
	\draw [draw=c3med, fill=c3med!60, thick] (.5, 0) -- (4.5,0) -- (4.5, 12) -- (.5, 12) -- (.5, 0); 
	\draw [draw=c2med, fill=c2med!60, thick] (2.1, 0) -- (2.1, .4) -- (2.9, .4) -- (2.9, 0) -- (2.1, 0); 
	\draw [thick] (0,0) -- (5,0) -- (5,12.5) -- (0,12.5) -- (0,0);
	\draw [ultra thick] (2.4,0) -- (2.6, 0);
	\node [below] at (2.6,0) {\scriptsize{Jet Inlet}};
	\node [below] at (2.6,-.5) {\scriptsize{$v_j$, $T_j$}};
	\node [right] at (0.8, 10.4) {\scriptsize{Ambient Fluid}};
	\node [right] at (1.6, 9.9) {\scriptsize{$v_0 = 0$}};
	\node [right] at (1.6, 9.4) {\scriptsize{$T_0$, $p_0$}};
	\node [right] at (5, 6.25) {\footnotesize{$62.5d$}};
	\node [above] at (2.5, 12.5) {\footnotesize{$25d$}};
	%\node [below, c2med] at (.8, 2.2) {\tiny{4 levels}};
	%\node [below, c3med] at (6.25, .6) {\tiny{$\omega$ refinement}};
	\node [below] at (2.5, 12.6) {\scriptsize{Outflow BC}};
\end{tikzpicture}
\hspace{.1in}
\begin{tikzpicture} [scale = .75]
	\draw [<->] (0,2.15) -- (0,1.15) -- (1,1.15);
	\draw[->] (0,1.15) -- (.5,1.4);
	\node [right] at (.85,1.175) {\tiny{$x$}};
	\node [right] at (.3, 1.5) {\tiny{$z$}};
	\node [above] at (0,2.025) {\tiny{$y$}};
\end{tikzpicture}
\caption{Two dimensional slice schematic of jet setup. Four levels of refinement are enforced within the green box based on proximity to jet inlet. Refinement based on vorticity criterion then occurs within the blue region. Outside the blue region, \gls{amr} is explicitly turned off to allow flow structures to be dissipated numerically and allowed to leave the domain without incurring spurious reflections.}
\label{fig:domain}
\end{figure}

\subsection{Initial and Boundary Conditions}
Our inlet consists of an opening centered in the $xz$-plane with diameter $d=\SI{.01}{cm}$ through which the \gls{sco2} jet is initialized. The pressure in the jet at the inlet is the same as that of the quiescent background fluid and it is given by $p_{j}=p_{0}=\SI{10.1325}{MPa}$. The ambient fluid remains at rest while the jet is initialized with an inflow velocity of $v_{j} = \SI{1800}{cm.s^{-1}}$, leading to a Reynolds number of the initialized jet of $Re_j = 22910$, with $v_{j}$ and $d$ being the reference velocity and length scale respectively. For the jet temperature and pressure conditions given, the reference density is $\rho_j=$ \SI{3.019e-1}{g.cm^{-3}}, as calculated via the \gls{srk} in \textit{PeleC}. To implement a turbulent inflow, we add noise to this input velocity using the mean velocity and \gls{rms} values from a predetermined \gls{dns} velocity profile \cite{DNS}. We begin by scaling the \gls{dns} values with our given jet velocity and radius. After determining which scaled \gls{dns} values we are near for the radius determined by our mesh, a linear interpolant is created to compute the mean velocity at our given radius. Noise is then added to each cylindrical component of the velocity as follows:
\begin{subequations} \label{Jet Inflow}
	\begin{align}
		v &= \langle v_{\text{\tiny{DNS}}} \rangle + \big(  v'_{\text{\tiny{DNS}}}  + \beta  v'_{\text{\tiny{DNS}}}    	r_1\sin{\theta_1}  \big) \cdot r_2 \sin{\theta_2} \label{y_flow} \\
		u &=   u'_{\text{\tiny{DNS}}}  + \beta  u'_{\text{\tiny{DNS}}}  r_3\sin{\theta_3} \label{t_flow} \\
		w &=   w'_{\text{\tiny{DNS}}}  + \beta  w'_{\text{\tiny{DNS}}}  r_4\sin{\theta_4}  \label{theta_flow}
	\end{align}
\end{subequations}  

\noindent where $\langle u_y \rangle$ is the mean velocity in the axial direction, $ u' = \langle u^2 \rangle^{\frac{1}{2}} $ is the \gls{rms} for each velocity component, and $\beta = 0.1$. Each $r_i$ and $\theta_k$ value is randomly generated as follows:
\begin{subequations} \label{Random_Variables}
	\begin{align}
		r_i &= \sqrt{-2.0 \log{(X_i)}} \label{Random_r} \\
		\theta_k &= 2 \pi X_k \label{Radom_theta}
	\end{align}
\end{subequations}

\noindent where $X_n$ are random numbers between 0 and 1. The inflow parameters are finalized after being converted into Cartesian coordinates.

We implement zero gradient boundary conditions for all boundaries not involving the jet inflow. Additionally, \gls{amr} is halted at a distance of $2.5d$ from the boundary in the $x$ and $z$ directions, and that of $5d$ in the axial direction in order to ensure that all waves are dissipated, thus avoiding spurious reflections from the boundaries. 

\section{Case Descriptions}
Three cases are investigated in this study. The first case pertains to an isothermal jet, in which the jet conditions match that of the ambient fluid for all quantities aside from velocity. The other two cases consider non-isothermal jets, in which the ambient fluid is adjusted to no longer match the temperature of the jet inflow. All three cases consider the same inflow conditions, while ambient fluid conditions are what varies between them. Temperatures for the ambient fluid in the non-isothermal cases are chosen such that the ambient fluid is supercritical but the temperature for each case falls on either side of the peak in specific heat seen near the critical point. This peak is associated with the pseudo-boiling phenomenon seen in supercritical fluids, where upon crossing the Widom line, the supercritical fluid experiences a shift from being more gas-like to more liquid-like in nature, although distinct phase separation between the two is not present. A summary of the conditions for each case can be seen in Table \ref{Case-Params}.
\begin{table}[H]
\caption{Summary of Jet Parameters for each case.}
\label{Case-Params}
\begin{center}
\begin{tabular}{ r || r r r  }
Parameter &Case 1 & Case 2 & Case 3 \\
\hline
$p_{in}$ MPa& 10.1325 &10.1325 & 10.1325 \\
$p_{\infty}$ g/cm$^3$& 10.1325 & 10.1325 & 10.1325 \\
$T_{in}$ K& 330 & 330 & 330 \\
$T_{\infty}$ K& 330& 350 & 314  \\
$v_{in}$ (cm/s)& 1800 & 1800 & 1800  \\
$\rho_{in}$ g/cm$^3$& 10.1325 & 10.1325 & 10.1325 \\
$R_{in}$ & 22911 & 22911 & 22911  \\
$M_{in}$ & 0.08 & 0.08 & 0.08  \\
\end{tabular}
\end{center}
\end{table}

The goal in choosing the ambient temperature in this way is to investigate the impact of large thermodynamic changes on the flow field of the supercritical jet. An example of this can be seen with the sharp peak in constant pressure specific heat in Figure \ref{cp_vs_case}. This choice differs from similar studies, which typically involve transcritical injection. 

\begin{figure}[H]
\begin{center}
\includegraphics[scale=0.5]{figures/cp_cases.png}
\end{center}
\caption{Extreme thermodynamic variation seen near critical point with ambient temperatures plotted for reference to see regime coverage of each case. Red is the jet temperature for all cases and isothermal temperature for the ambient case. Blue is the $350 K$ ambient case. Green is the $314 K$ ambient case. }
\label{cp_vs_case}
\end{figure}

\section{Compute Time and Hardware Specifications}
Simulations were run on the \gls{nrel} Eagle supercomputer using the Intel suite of compilers. Simulations utilized 576 MPI ranks in total, with 36 ranks spread across 16 nodes. Roughly 17,000 cells were handled per MPI rank. Dynamic load balancing of AMR levels allowed for maximum utilization of the system. In total, over 100 TB of data were stored from the original 3D simulations run over the course of the 10 flow-throughs of the domain needed for averaging procedures. To help manage data storage issues, slicing procedures were implemented to reduce full 3D simulation data down to 2D slice data, where averaging procedures were then performed as outlined in the next section. 
\section{Post-Processing Procedures}
Post-processing procedures were written in Python and primarily leveraged the following libraries: yt, pandas, numpy, and, matplotlib. Original 3D data at each plotfile was sliced in three different ways using yt: along the centerline to create 1D data, normal to the jet axis at various points down stream to create 2D data, and along the axial direction at $z=0$ to create 2D data. 

For time averaging, a basic discrete averaging procedure was implemented over $i$ saved plot files from the final 2 flow-throughs of the simulation, with 100 plots saved per flow-through:
\begin{equation} \label{discrete_time_avg}
\phi_{avg, slice} = \dfrac{1}{200} \sum\limits_{i=1}^{200} \phi_{i, slice}
\end{equation}

Radial averages were approximated with $r = 0$ lying in the center of the $xz-$plane with $r = \sqrt{x^2 + z^2}$. The $N$ points nearest to each fixed $r$ distance away from the center were then averaged together:
\begin{equation} \label{discrete_time_avg}
\phi_{avg, r} = \dfrac{1}{N} \sum\limits_{i=1}^{N} \phi_{i, r}
\end{equation}

For quantities that were averaged in both time and radially, temporal averaging was performed first, with the radial average then taken of the time averaged slice data. 


